<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.pineapple.pms.service.PmsMapper">
	<!-- wbsplan 생성 요청 쿼리 -->
	<insert id="insertWbsPlan" parameterType="com.pineapple.pms.service.WbsPlan">
		INSERT INTO wbsplan
		(wbsPlanCode, wbsPlanFdCode, wbsPlanMsCode, wbsPlanOrder, wbsPlanChange, wbsPlanName,
		 wbsPlanDependency, wbsPlanStartDate, wbsPlanDuration, wbsPlanWriteDate, wbsPlanManager, wbsPlanComCode)
		 
		VALUES (NULL, #{wbsPlanFdCode}, #{wbsPlanMsCode}, #{wbsPlanOrder}, 0, #{wbsPlanName}, #{wbsPlanDependency},
				#{wbsPlanStartDate}, #{wbsPlanDuration}, NOW(), #{wbsPlanManager}, #{wbsPlanComCode});
	</insert>
	<insert id="insertWbsPlanHuman" parameterType="com.pineapple.pms.service.WbsPlanHuman">
		INSERT INTO wbsplanhuman
		(wphCode, wphFdCode, wphMsCode, wphWpCode, wphNoPeople, wphCost, wphStartDate, wphEndDate, wphRemarks, wphComCode)
		VALUES (NULL, #{wphFdCode}, #{wphMsCode}, #{wphWpCode}, #{wphNoPeople}, #{wphCost}, #{wphStartDate}, #{wphEndDate}, #{wphRemarks}, #{wphComCode})
	</insert>
	<insert id="insertWbsPlanMaterial" parameterType="com.pineapple.pms.service.WbsPlanMaterial">
		INSERT INTO wbsplanmaterial
			(wpmCode, wpmFdCode, wpmMsCode, wpmWpCode, wpmName, wpmNo, wpmCostPerNo, wpmCost, wpmStartDate, wpmEndDate, wpmRemarks, wpmComCode)
			VALUES (NULL, #{wpmFdCode}, #{wpmMsCode}, #{wpmWpCode}, #{wpmName}, #{wpmNo}, #{wpmCostPerNo}, #{wpmCost}, #{wpmStartDate}, #{wpmEndDate}, #{wpmRemarks}, #{wpmComCode})
	</insert>
	
	<insert id="wbsplanfacilityinsert" parameterType="com.pineapple.pms.service.WbsPlanFacility">
		INSERT INTO wbsplanfacility
			(wpfCode, wpfFdCode, wpfMsCode, wpfWpCode, wpfName, wpfCost, wpfStartDate, wpfEndDate, wpfRemarks, wpfComCode)
			VALUES (NULL, #{wpfFdCode}, #{wpfMsCode}, #{wpfWpCode}, #{wpfName}, #{wpfCost}, #{wpfStartDate}, #{wpfEndDate}, #{wpfRemarks}, #{wpfComCode})
	</insert>
	
	<insert id="wbsplanoutinsert" parameterType="com.pineapple.pms.service.WbsPlanOut">
		INSERT INTO wbsplanout
			(wpoCode, wpoFdCode, wpoMsCode, wpoWpCode, wpoOutComName, wpoCost, wpoStartDate, wpoEndDate, wpoRemarks, wpoComCode)
			VALUES (NULL, #{wpoFdCode}, #{wpoMsCode}, #{wpoWpCode}, #{wpoOutComName}, #{wpoCost}, #{wpoStartDate}, #{wpoEndDate}, #{wpoRemarks}, #{wpoComCode})
	</insert>
	
	<insert id="wbsplanetcinser" parameterType="com.pineapple.pms.service.WbsPlanEtc">
		INSERT INTO wbsplanetc
			(wpeCode, wpeFdCode, wpeMsCode, wpeWpCode, wpePurpose, wpeCost, wpeStartDate, wpeEndDate, wpeRemarks, wpeComCode)
			VALUES (NULL, #{wpeFdCode}, #{wpeMsCode}, #{wpeWpCode}, #{wpePurpose}, #{wpeCost}, #{wpeStartDate}, #{wpeEndDate}, #{wpeRemarks}, #{wpeComCode})
	</insert>
	<insert id="wbsplanincomeinsert" parameterType="com.pineapple.pms.service.WbsPlanIncome">
		INSERT INTO wbsplanincome
			(wpiCode, wpiFdCode, wpiMsCode, wpiWpCode, wpiReason, wpiIncome, wpiStartDate, wpiEndDate, wpiComCode)
			VALUES (NULL, #{wpiFdCode}, #{wpiMsCode}, #{wpiWpCode}, #{wpiReason}, #{wpiIncome}, #{wpiStartDate}, #{wpiEndDate}, #{wpiComCode})
	</insert>
	
	
	<!-- wbsplan 리스트 요청쿼리 -->
	<select id="selectWbsPlan" resultType="com.pineapple.pms.service.WbsPlanView" parameterType="String">
		SELECT w.wbsPlanCode, w.wbsPlanOrder,
			w.wbsPlanName, w.wbsPlanDependency, max(w.wbsPlanChange) wbsPlanChange,
			w.wbsPlanStartDate, w.wbsPlanDuration, w.wbsPlanComCode,
			w.wbsPlanManager, w.wbsPlanFdCode, w.wbsPlanMsCode,
			f.fdTitle, m.milestoneName
		FROM wbsplan w LEFT JOIN funding f ON w.wbsPlanFdCode = f.fdCode 
		LEFT JOIN milestone m ON w.wbsPlanMsCode = m.milestoneCode
		where w.wbsPlanComCode = ANY 
		(SELECT e.emComCode 
		FROM user u INNER JOIN employee e 
		ON u.userId = e.emUserId
		WHERE u.userId = #{userId}) group by w.wbsPlanOrder , w.wbsPlanMsCode
	</select>
	<!-- wbsplanHuman 리스트 요청쿼리 -->
	<select id="selectWbsPlanHuman" resultType="com.pineapple.pms.service.WbsPlanHuman" parameterType="String">
		select *
		from wbsplanhuman where wphWpCode = #{wbsplancode}
	</select>
	<select id="selectWbsPlanMaterial" resultType="com.pineapple.pms.service.WbsPlanMaterial" parameterType="String">
		select *
		from wbsplanmaterial where wpmWpCode = #{wbsplancode}
	</select>
	<select id="selectWbsPlanFacility" resultType="com.pineapple.pms.service.WbsPlanFacility" parameterType="String">
		select *
		from wbsplanfacility where wpfWpCode = #{wbsplancode}
	</select>
	<select id="selectWbsPlanOut" resultType="com.pineapple.pms.service.WbsPlanOut" parameterType="String">
		select *
		from wbsplanout where wpoWpCode = #{wbsplancode}
	</select>
	<select id="selectWbsPlanEtc" resultType="com.pineapple.pms.service.WbsPlanEtc" parameterType="String">
		select *
		from wbsplanetc where wpeWpCode = #{wbsplancode}
	</select>
	<select id="selectWbsPlanIncome" resultType="com.pineapple.pms.service.WbsPlanIncome" parameterType="String">
		select *
		from wbsplanincome where wpiWpCode = #{wbsplancode}
	</select>
	
		<select id="selectdetail" parameterType="String" resultType="com.pineapple.pms.service.WbsPlanView">
		SELECT w.wbsPlanCode, w.wbsPlanOrder,
				w.wbsPlanName, w.wbsPlanDependency,
				w.wbsPlanStartDate, w.wbsPlanDuration, w.wbsPlanComCode,
				w.wbsPlanManager, w.wbsPlanFdCode, w.wbsPlanMsCode,
				f.fdTitle, m.milestoneName
		FROM wbsplan w LEFT JOIN funding f ON w.wbsPlanFdCode = f.fdCode 
		LEFT JOIN milestone m ON w.wbsPlanMsCode = m.milestoneCode 
		where wbsPlanCode=#{wbsplancode};
	</select>
	<delete id="deletewbsplan" parameterType="String">
		DELETE FROM wbsplan WHERE wbsPlanCode= #{wbsplancode}
	</delete>
	<delete id="deletehuman" parameterType="String">
		DELETE FROM wbsplanhuman WHERE wphWpCode= #{wbsplancode}
	</delete>
	<delete id="deletematerial" parameterType="String">
		DELETE FROM wbsplanmaterial WHERE wpmWpCode= #{wbsplancode}
	</delete>
	<delete id="deletefacility" parameterType="String">
		DELETE FROM wbsplanfacility WHERE wpfWpCode= #{wbsplancode}
	</delete>
	<delete id="deleteout" parameterType="String">
		DELETE FROM wbsplanout WHERE wpoWpCode= #{wbsplancode}
	</delete>
	<delete id="deleteetc" parameterType="String">
		DELETE FROM wbsplanetc WHERE wpeWpCode= #{wbsplancode}
	</delete>
	<delete id="deleteincome" parameterType="String">
		DELETE FROM wbsplanincome WHERE wpiWpCode= #{wbsplancode}
	</delete>
	<delete id="deletewbsplanhuman" parameterType="String">
		DELETE FROM wbsplanhuman WHERE wphCode= #{wbhcode}
	</delete>
	<delete id="deletewbsplanmaterial" parameterType="String">
		DELETE FROM wbsplanmaterial WHERE wpmCode= #{wbmcode}
	</delete>
	<delete id="deletewbsplanfacility" parameterType="String">
		DELETE FROM wbsplanfacility WHERE wpfCode= #{wbfcode}
	</delete>
	<delete id="deletewbsplanout" parameterType="String">
		DELETE FROM wbsplanout WHERE wpoCode= #{wbocode}
	</delete>
		<delete id="deletewbsplanetc" parameterType="String">
		DELETE FROM wbsplanetc WHERE wpeCode= #{wbecode}
	</delete>
		<delete id="deletewbsplanincome" parameterType="String">
		DELETE FROM wbsplanincome WHERE wpiCode= #{wbicode}
	</delete>
	
	<update id="updatewbsplanhuman" parameterType="com.pineapple.pms.service.WbsPlanHuman">
		UPDATE wbsplanhuman
			SET
				wphNoPeople=#{wphNoPeople},
				wphCost=#{wphCost},
				wphStartDate=#{wphStartDate},
				wphEndDate=#{wphEndDate},
				wphRemarks=#{wphRemarks}
			WHERE wphCode=#{wphCode}
	</update>
	
	<update id="wbsplanmaterialupdate" parameterType="com.pineapple.pms.service.WbsPlanMaterial">
		UPDATE wbsplanmaterial
			SET
				wpmName=#{wpmName},
				wpmNo=#{wpmNo},
				wpmCostPerNo=#{wpmCostPerNo},
				wpmCost=#{wpmCost},
				wpmStartDate=#{wpmStartDate},
				wpmEndDate=#{wpmEndDate},
				wpmRemarks=#{wpmRemarks}
			WHERE wpmCode=#{wpmCode}
	</update>
	
	<update id="wbsplanfacilityupdate" parameterType="com.pineapple.pms.service.WbsPlanFacility">
		UPDATE wbsplanfacility
			SET
				wpfName=#{wpfName},
				wpfCost=#{wpfCost},
				wpfStartDate=#{wpfStartDate},
				wpfEndDate=#{wpfEndDate},
				wpfRemarks=#{wpfRemarks}
			WHERE wpfCode = #{wpfCode}
	</update>
	
	<update id="wbsplanoutupdate" parameterType="com.pineapple.pms.service.WbsPlanOut">
		UPDATE wbsplanout
			SET
				wpoOutComName=#{wpoOutComName},
				wpoCost=#{wpoCost},
				wpoStartDate=#{wpoStartDate},
				wpoEndDate=#{wpoEndDate},
				wpoRemarks=#{wpoRemarks}
			WHERE wpoCode = #{wpoCode}
	</update>
	
	<update id="wbsplanetcupdate" parameterType="com.pineapple.pms.service.WbsPlanEtc">
		UPDATE wbsplanetc
			SET
				wpePurpose=#{wpePurpose},
				wpeCost=#{wpeCost},
				wpeStartDate=#{wpeStartDate},
				wpeEndDate=#{wpeEndDate},
				wpeRemarks=#{wpeRemarks}
			WHERE wpeCode =#{wpeCode}
	</update>
	
	<update id="wbsplanincomeupdate" parameterType="com.pineapple.pms.service.WbsPlanIncome">
		UPDATE wbsplanincome
			SET
				wpiReason=#{wpiReason},
				wpiIncome=#{wpiIncome},
				wpiStartDate=#{wpiStartDate},
				wpiEndDate=#{wpiEndDate}
			WHERE wpiCode = #{wpiCode}
	</update>
</mapper>