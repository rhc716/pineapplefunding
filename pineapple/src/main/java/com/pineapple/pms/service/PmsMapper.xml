<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.pineapple.pms.service.PmsMapper">
	<!-- wbsplan 생성 요청 쿼리 -->
	<insert id="insertWbsPlan" parameterType="com.pineapple.pms.service.WbsPlan">
		INSERT INTO wbsplan
		(wbsPlanCode, wbsPlanFdCode, wbsPlanMsCode, wbsPlanOrder, wbsPlanChange, wbsPlanName,
		 wbsPlanDependency, wbsPlanStartDate, wbsPlanDuration, wbsPlanWriteDate, wbsPlanManager, wbsPlanComCode)
		 
		VALUES (NULL, #{wbsPlanFdCode}, #{wbsPlanMsCode}, #{wbsPlanOrder}, 0, #{wbsPlanName}, #{wbsPlanDependency},
				#{wbsPlanStartDate}, #{wbsPlanDuration}, NOW(), #{wbsPlanManager}, #{wbsPlanComCode});
	</insert>
	<insert id="insertWbsPlanHuman" parameterType="com.pineapple.pms.service.WbsPlanHuman">
		INSERT INTO wbsplanhuman
		(wphCode, wphFdCode, wphMsCode, wphWpCode, wphNoPeople, wphCost, wphStartDate, wphEndDate, wphRemarks, wphComCode)
		VALUES (NULL, #{wphFdCode}, #{wphMsCode}, #{wphWpCode}, #{wphNoPeople}, #{wphCost}, #{wphStartDate}, #{wphEndDate}, #{wphRemarks}, #{wphComCode})
	</insert>
	<insert id="insertWbsPlanMaterial" parameterType="com.pineapple.pms.service.WbsPlanMaterial">
		INSERT INTO wbsplanmaterial
			(wpmCode, wpmFdCode, wpmMsCode, wpmWpCode, wpmName, wpmNo, wpmCostPerNo, wpmCost, wpmStartDate, wpmEndDate, wpmRemarks, wpmComCode)
			VALUES (NULL, #{wpmFdCode}, #{wpmMsCode}, #{wpmWpCode}, #{wpmName}, #{wpmNo}, #{wpmCostPerNo}, #{wpmCost}, #{wpmStartDate}, #{wpmEndDate}, #{wpmRemarks}, #{wpmComCode})
	</insert>
	
	<!-- wbsplan 리스트 요청쿼리 -->
	<select id="selectWbsPlan" resultType="com.pineapple.pms.service.WbsPlanView" parameterType="String">
		SELECT w.wbsPlanCode, w.wbsPlanOrder,
			w.wbsPlanName, w.wbsPlanDependency,
			w.wbsPlanStartDate, w.wbsPlanDuration, w.wbsPlanComCode,
			w.wbsPlanManager, w.wbsPlanFdCode, w.wbsPlanMsCode,
			f.fdTitle, m.milestoneName
		FROM wbsplan w LEFT JOIN funding f ON w.wbsPlanFdCode = f.fdCode 
		LEFT JOIN milestone m ON w.wbsPlanMsCode = m.milestoneCode
		where w.wbsPlanComCode = ANY 
		(SELECT e.emComCode 
		FROM user u INNER JOIN employee e 
		ON u.userId = e.emUserId
		WHERE u.userId = #{userId})
	</select>
	<!-- wbsplanHuman 리스트 요청쿼리 -->
	<select id="selectWbsPlanHuman" resultType="com.pineapple.pms.service.WbsPlanHuman" parameterType="String">
		select *
		from wbsplanhuman where wphWpCode = #{wbsplancode}
	</select>
	<select id="selectWbsPlanMaterial" resultType="com.pineapple.pms.service.WbsPlanMaterial" parameterType="String">
		select *
		from wbsplanmaterial where wpmWpCode = #{wbsplancode}
	</select>
		<select id="selectdetail" parameterType="String" resultType="com.pineapple.pms.service.WbsPlanView">
		SELECT w.wbsPlanCode, w.wbsPlanOrder,
				w.wbsPlanName, w.wbsPlanDependency,
				w.wbsPlanStartDate, w.wbsPlanDuration, w.wbsPlanComCode,
				w.wbsPlanManager, w.wbsPlanFdCode, w.wbsPlanMsCode,
				f.fdTitle, m.milestoneName
		FROM wbsplan w LEFT JOIN funding f ON w.wbsPlanFdCode = f.fdCode 
		LEFT JOIN milestone m ON w.wbsPlanMsCode = m.milestoneCode 
		where wbsPlanCode=#{wbsplancode};
	</select>
	<delete id="deletewbsplanhuman" parameterType="String">
		DELETE FROM wbsplanhuman WHERE wphCode= #{wbhcode}
	</delete>
	<delete id="deletewbsplanmaterial" parameterType="String">
		DELETE FROM wbsplanmaterial WHERE wpmCode= #{wbmcode}
	</delete>
	
	<update id="updatewbsplanhuman" parameterType="com.pineapple.pms.service.WbsPlanHuman">
		UPDATE wbsplanhuman
			SET
			wphNoPeople=#{wphNoPeople},
			wphCost=#{wphCost},
			wphStartDate=#{wphStartDate},
			wphEndDate=#{wphEndDate},
			wphRemarks=#{wphRemarks}
		WHERE wphCode=#{wphCode}
	</update>
</mapper>